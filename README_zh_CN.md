# 思源笔记代码差异对比挂件

一个自动显示超级块中两个代码块差异的思源笔记挂件。

[English](README.md)

## 功能特性

- 🔄 **自动刷新**：每5秒自动更新差异对比结果
- 📝 **模板插入**：一键插入对比模板结构
- 🎨 **可视化对比**：清晰的可视化显示，绿色（新增）和红色（删除）
- 📊 **统计信息**：显示新增和删除的行数
- 🖥️ **100%宽度**：默认全宽显示
- ⚡ **实时显示**：从上方超级块读取内容并立即显示差异

## 使用方法

### 基本工作流程

```
┌────────────────────────────────────────┐
│  超级块（左右并排）                      │
│  ┌─────────────┐  ┌─────────────┐     │
│  │ ```         │  │ ```         │     │
│  │ 原始代码    │  │ 修改后代码   │     │
│  │ ```         │  │ ```         │     │
│  └─────────────┘  └─────────────┘     │
└────────────────────────────────────────┘
              ↓
┌────────────────────────────────────────┐
│  Widget（只显示diff结果）                │
│  - 删除的行（红色背景）                   │
│  + 新增的行（绿色背景）                   │
│    未改变的行                            │
└────────────────────────────────────────┘
```

### 分步指南

1. **插入挂件**：在思源笔记文档中添加此挂件
2. **插入模板**：点击"📝 插入对比模板"按钮，自动在挂件上方插入超级块模板
3. **添加代码**：用实际代码替换占位符文本（左侧：原始代码，右侧：修改后代码）
4. **查看差异**：差异对比结果会自动显示在下方的挂件中

### 手动设置

如果你喜欢手动创建结构：

1. 在挂件上方创建一个行布局的超级块
2. 在超级块中并排添加两个代码块
3. 在左侧代码块中放置原始代码
4. 在右侧代码块中放置修改后的代码
5. 挂件会自动检测并显示差异

## 控制按钮

- **📝 插入对比模板**：在挂件上方插入对比模板结构
- **🔄 刷新对比**：手动刷新差异对比（也会每5秒自动刷新）

## 显示特性

- **行号**：显示行号以便参考
- **颜色编码**：
  - 🟢 绿色背景：新增的行
  - 🔴 红色背景：删除的行
  - ⚪ 白色背景：未改变的行
- **统计信息**：显示新增和删除的总行数
- **响应式**：全宽显示，自适应容器大小

## 安装方法

1. 从思源笔记集市下载此挂件
2. 或将此仓库克隆到 `{工作空间}/conf/appearance/widgets/sy-widget-show-diff`
3. 重启思源笔记或刷新挂件列表

## 系统要求

- 思源笔记版本：2.8.8 或更高
- 挂件必须放置在包含两个代码块的超级块下方

## 技术细节

- 使用最长公共子序列（LCS）算法进行精确的差异计算
- 通过本地 API 与思源笔记通信（http://127.0.0.1:6806）
- 纯 JavaScript 实现，无外部依赖
- 自动检测挂件位置并从上方超级块读取内容

## 常见问题

**错误："在挂件上方未找到超级块"**
- 确保挂件正上方有一个超级块
- 超级块应该包含至少两个代码块

**差异结果为空**
- 检查两个代码块是否都包含内容
- 验证代码块是否正确使用 ``` 标记格式化

**挂件无法加载**
- 确保思源笔记正在运行
- 检查 API 端口 6806 是否可访问
- 尝试手动点击"🔄 刷新对比"按钮

## 开发

### 项目结构

```
sy-widget-show-diff/
├── widget.json          # 挂件配置文件
├── index.html          # 主HTML文件（包含CSS和JavaScript）
├── icon.png            # 挂件图标（160x160）
├── preview.png         # 预览图（1024x768）
├── README.md           # 英文说明文档
├── README_zh_CN.md     # 中文说明文档
└── LICENSE             # 许可证文件
```

### 打包发布

1. 确保所有必需文件都存在
2. 创建 package.zip，包含以上所有文件
3. 在 GitHub 上创建新的发布版本
4. 上传 package.zip 作为附件

## 许可证

MIT License

## 作者

xiaoduo

## 链接

- GitHub：https://github.com/xiaoduo/sy-widget-show-diff
- 问题反馈：https://github.com/xiaoduo/sy-widget-show-diff/issues

## 更新日志

### v0.0.1
- 初始版本发布
- 实现基本的代码差异对比功能
- 支持自动刷新
- 支持一键插入模板
- 100%宽度显示
